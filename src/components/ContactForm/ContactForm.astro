---
---

<form class="contact-form" id="contact-form" novalidate>
  <div class="form-row">
    <div class="form-field">
      <label class="form-label label" for="contact-name">Full name *</label>
      <input
        type="text"
        id="contact-name"
        name="name"
        class="form-input"
        placeholder="Alex Johnson"
        required
        autocomplete="name"
      />
      <span class="form-error" role="alert"></span>
    </div>

    <div class="form-field">
      <label class="form-label label" for="contact-email">Work email *</label>
      <input
        type="email"
        id="contact-email"
        name="email"
        class="form-input"
        placeholder="alex@company.com"
        required
        autocomplete="email"
      />
      <span class="form-error" role="alert"></span>
    </div>
  </div>

  <div class="form-row">
    <div class="form-field">
      <label class="form-label label" for="contact-company">Company</label>
      <input
        type="text"
        id="contact-company"
        name="company"
        class="form-input"
        placeholder="Acme Corp"
        autocomplete="organization"
      />
    </div>

    <div class="form-field">
      <label class="form-label label" for="contact-budget">Monthly budget</label>
      <select id="contact-budget" name="budget" class="form-input form-select">
        <option value="">Select range...</option>
        <option value="2k-5k">$2,000 – $5,000/mo</option>
        <option value="5k-15k">$5,000 – $15,000/mo</option>
        <option value="15k-50k">$15,000 – $50,000/mo</option>
        <option value="50k+">$50,000+/mo</option>
        <option value="custom">Let's talk</option>
      </select>
    </div>
  </div>

  <div class="form-field">
    <label class="form-label label" for="contact-message">Tell us about your project *</label>
    <textarea
      id="contact-message"
      name="message"
      class="form-input form-textarea"
      placeholder="Describe your current challenges and what you're hoping to achieve with AI automation..."
      rows="5"
      required
    ></textarea>
    <span class="form-error" role="alert"></span>
  </div>

  <button type="submit" class="btn btn-primary form-submit" data-magnetic>
    Send message
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <path d="M1 8h14M9 2l6 6-6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <!-- Success message -->
  <div class="form-success" id="form-success" aria-live="polite" hidden>
    <span class="form-success-icon">✓</span>
    <div>
      <p class="heading-md">Message sent!</p>
      <p class="body-sm text-muted">We'll get back to you within 24 hours.</p>
    </div>
  </div>
</form>

<style>
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-lg);
  }

  .form-field {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .form-label {
    color: var(--color-text-secondary);
    font-size: 0.75rem;
  }

  .form-input {
    padding: 0.875rem 1rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-primary);
    font-family: var(--font-body);
    font-size: 0.9375rem;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    width: 100%;
    appearance: none;
    -webkit-appearance: none;
  }

  .form-input::placeholder {
    color: var(--color-text-tertiary);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--color-cyan);
    box-shadow: 0 0 0 3px var(--color-cyan-dim);
  }

  .form-input.error {
    border-color: #ff4444;
  }

  .form-select {
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
    cursor: pointer;
  }

  .form-textarea {
    resize: vertical;
    min-height: 140px;
    line-height: 1.6;
  }

  .form-error {
    font-size: 0.8rem;
    color: #ff4444;
    min-height: 1.2em;
  }

  .form-submit {
    align-self: flex-start;
    min-width: 180px;
    justify-content: center;
  }

  /* Success */
  .form-success {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-xl);
    background: var(--color-green-dim);
    border: 1px solid rgba(57, 255, 20, 0.3);
    border-radius: var(--radius-lg);
  }

  .form-success[hidden] {
    display: none;
  }

  .form-success-icon {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: var(--color-green);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: #0A0A0A;
    font-weight: 700;
    flex-shrink: 0;
  }

  @media (max-width: 640px) {
    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  function initContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement | null;
    const success = document.getElementById('form-success');
    if (!form || !success) return;

    function validateField(input: HTMLInputElement | HTMLTextAreaElement): boolean {
      const errorEl = input.closest('.form-field')?.querySelector('.form-error') as HTMLElement | null;
      let error = '';

      if (input.required && !input.value.trim()) {
        error = 'This field is required.';
      } else if (input.type === 'email' && input.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
        error = 'Please enter a valid email address.';
      }

      input.classList.toggle('error', !!error);
      if (errorEl) errorEl.textContent = error;
      return !error;
    }

    // Live validation
    form.querySelectorAll<HTMLInputElement | HTMLTextAreaElement>('input, textarea').forEach((input) => {
      input.addEventListener('blur', () => validateField(input));
      input.addEventListener('input', () => {
        if (input.classList.contains('error')) validateField(input);
      });
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const inputs = form.querySelectorAll<HTMLInputElement | HTMLTextAreaElement>('input[required], textarea[required]');
      let valid = true;

      inputs.forEach((input) => {
        if (!validateField(input)) valid = false;
      });

      if (!valid) return;

      // Simulate submission
      const submitBtn = form.querySelector<HTMLButtonElement>('.form-submit');
      if (submitBtn) {
        submitBtn.textContent = 'Sending...';
        submitBtn.disabled = true;
      }

      setTimeout(() => {
        form.style.display = 'none';
        success.removeAttribute('hidden');
      }, 1200);
    });
  }

  initContactForm();
  document.addEventListener('astro:after-swap', initContactForm);
</script>
