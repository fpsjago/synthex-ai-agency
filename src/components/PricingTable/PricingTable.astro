---
const tiers = [
  {
    name: 'Starter',
    price: { monthly: 2000, annual: 1700 },
    description: 'For early-stage companies exploring AI automation.',
    features: [
      'Up to 2 automation workflows',
      'LLM integration (1 model)',
      'Basic data pipeline setup',
      'Email support',
      'Monthly strategy call',
      'Standard SLA (48hr response)',
    ],
    cta: 'Get started',
    highlighted: false,
  },
  {
    name: 'Growth',
    price: { monthly: 5000, annual: 4250 },
    description: 'For scaling companies ready to commit to AI-first operations.',
    features: [
      'Up to 8 automation workflows',
      'Multi-model LLM orchestration',
      'Full data pipeline architecture',
      'RAG system implementation',
      'Dedicated Slack channel',
      'Weekly strategy calls',
      'Priority SLA (4hr response)',
      'Custom dashboard',
    ],
    cta: 'Start growing',
    highlighted: true,
  },
  {
    name: 'Enterprise',
    price: { monthly: 'custom', annual: 'custom' },
    description: 'For organizations deploying AI at scale across multiple teams.',
    features: [
      'Unlimited automation workflows',
      'Custom model fine-tuning',
      'Enterprise data infrastructure',
      'Agent development & deployment',
      'Embedded team member',
      'Daily check-ins',
      '1hr response SLA',
      'Custom integrations',
      'IP ownership + source code',
    ],
    cta: 'Contact us',
    highlighted: false,
  },
];
---

<div class="pricing-wrapper">
  <!-- Toggle -->
  <div class="pricing-toggle" role="group" aria-label="Billing frequency">
    <button class="pricing-toggle-btn active" id="toggle-monthly" data-period="monthly">Monthly</button>
    <button class="pricing-toggle-btn" id="toggle-annual" data-period="annual">
      Annual
      <span class="pricing-toggle-badge">Save 15%</span>
    </button>
  </div>

  <!-- Tiers -->
  <div class="pricing-grid">
    {tiers.map((tier) => (
      <div class={`pricing-card ${tier.highlighted ? 'pricing-card--featured' : ''}`}>
        {tier.highlighted && (
          <div class="pricing-featured-badge label">Most Popular</div>
        )}

        <div class="pricing-card-header">
          <h3 class="pricing-tier-name heading-lg">{tier.name}</h3>
          <div class="pricing-price-wrap">
            <div class="pricing-price" data-tier={tier.name.toLowerCase()}>
              {typeof tier.price.monthly === 'number' ? (
                <>
                  <span class="pricing-currency">$</span>
                  <span class="pricing-amount" data-monthly={tier.price.monthly} data-annual={tier.price.annual}>
                    {tier.price.monthly.toLocaleString()}
                  </span>
                  <span class="pricing-period text-muted">/mo</span>
                </>
              ) : (
                <span class="pricing-custom heading-md">Custom</span>
              )}
            </div>
          </div>
          <p class="pricing-desc body-sm text-muted">{tier.description}</p>
        </div>

        <ul class="pricing-features">
          {tier.features.map((feature) => (
            <li class="pricing-feature">
              <svg class="pricing-check" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M3 8l3.5 3.5L13 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="body-sm">{feature}</span>
            </li>
          ))}
        </ul>

        <a
          href={`/contact/`}
          class={`btn ${tier.highlighted ? 'btn-primary' : 'btn-secondary'} pricing-cta`}
          data-magnetic
        >
          {tier.cta}
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
            <path d="M1 7h12M8 2l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </div>
    ))}
  </div>
</div>

<style>
  .pricing-wrapper {
    display: flex;
    flex-direction: column;
    gap: var(--space-2xl);
    align-items: center;
  }

  /* Toggle */
  .pricing-toggle {
    display: flex;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    padding: 4px;
    gap: 4px;
  }

  .pricing-toggle-btn {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: 0.5rem 1.25rem;
    background: none;
    border: none;
    border-radius: var(--radius-full);
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: background-color var(--transition-fast), color var(--transition-fast);
  }

  .pricing-toggle-btn.active {
    background: var(--color-bg);
    color: var(--color-text-primary);
    box-shadow: var(--shadow-sm);
  }

  .pricing-toggle-badge {
    padding: 0.2rem 0.5rem;
    background: var(--color-green-dim);
    border: 1px solid rgba(57, 255, 20, 0.3);
    border-radius: var(--radius-full);
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--color-green);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  /* Grid */
  .pricing-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-lg);
    width: 100%;
    align-items: start;
  }

  /* Card */
  .pricing-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--space-2xl);
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
    position: relative;
    transition: border-color var(--transition-base), box-shadow var(--transition-base);
  }

  .pricing-card:hover {
    border-color: var(--color-cyan-border);
    box-shadow: var(--shadow-cyan);
  }

  .pricing-card--featured {
    border-color: var(--color-cyan-border);
    background: linear-gradient(180deg, var(--color-cyan-dim) 0%, var(--color-surface) 40%);
    box-shadow: var(--shadow-cyan);
  }

  .pricing-featured-badge {
    position: absolute;
    top: -1px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-cyan);
    color: #0A0A0A;
    padding: 0.25rem 0.875rem;
    border-radius: 0 0 var(--radius-md) var(--radius-md);
  }

  .pricing-card-header {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    padding-top: var(--space-md);
  }

  .pricing-tier-name {
    color: var(--color-text-primary);
  }

  .pricing-price-wrap {
    display: flex;
    align-items: baseline;
    gap: 0;
  }

  .pricing-price {
    display: flex;
    align-items: baseline;
    gap: 0.25rem;
  }

  .pricing-currency {
    font-family: var(--font-heading);
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-text-secondary);
    align-self: flex-start;
    margin-top: 0.5rem;
  }

  .pricing-amount {
    font-family: var(--font-heading);
    font-size: 3rem;
    font-weight: 700;
    letter-spacing: -0.04em;
    color: var(--color-text-primary);
    line-height: 1;
    transition: color var(--transition-fast);
  }

  .pricing-card--featured .pricing-amount {
    color: var(--color-cyan);
  }

  .pricing-period {
    font-size: 0.9rem;
    font-weight: 500;
  }

  .pricing-custom {
    color: var(--color-text-primary);
  }

  /* Features */
  .pricing-features {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    flex: 1;
  }

  .pricing-feature {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
  }

  .pricing-check {
    color: var(--color-cyan);
    flex-shrink: 0;
    margin-top: 1px;
  }

  .pricing-card--featured .pricing-check {
    color: var(--color-green);
  }

  .pricing-cta {
    width: 100%;
    justify-content: center;
  }

  @media (max-width: 1024px) {
    .pricing-grid {
      grid-template-columns: 1fr;
      max-width: 480px;
      margin: 0 auto;
    }
  }
</style>

<script>
  function initPricing() {
    const monthlyBtn = document.getElementById('toggle-monthly');
    const annualBtn = document.getElementById('toggle-annual');
    const amounts = document.querySelectorAll<HTMLElement>('.pricing-amount[data-monthly]');

    if (!monthlyBtn || !annualBtn) return;

    let currentPeriod = 'monthly';

    function updatePrices(period: string) {
      amounts.forEach((el) => {
        const monthly = parseInt(el.dataset.monthly || '0');
        const annual = parseInt(el.dataset.annual || '0');
        const val = period === 'monthly' ? monthly : annual;
        el.textContent = val.toLocaleString();
      });

      monthlyBtn.classList.toggle('active', period === 'monthly');
      annualBtn.classList.toggle('active', period === 'annual');
      currentPeriod = period;
    }

    monthlyBtn.addEventListener('click', () => updatePrices('monthly'));
    annualBtn.addEventListener('click', () => updatePrices('annual'));
  }

  initPricing();
  document.addEventListener('astro:after-swap', initPricing);
</script>
