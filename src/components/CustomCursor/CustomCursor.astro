---
---

<div class="cursor-dot" id="cursor-dot" aria-hidden="true"></div>
<div class="cursor-follower" id="cursor-follower" aria-hidden="true"></div>

<style>
  .cursor-dot {
    position: fixed;
    width: 6px;
    height: 6px;
    background: var(--color-cyan);
    border-radius: 50%;
    pointer-events: none;
    z-index: var(--z-cursor);
    transform: translate(-50%, -50%);
    transition: width 0.15s, height 0.15s, background-color 0.15s;
    mix-blend-mode: difference;
  }

  .cursor-follower {
    position: fixed;
    width: 36px;
    height: 36px;
    border: 1.5px solid var(--color-cyan);
    border-radius: 50%;
    pointer-events: none;
    z-index: var(--z-cursor);
    transform: translate(-50%, -50%);
    opacity: 0.5;
    transition: width 0.2s, height 0.2s, opacity 0.2s;
  }

  /* Hide on touch devices */
  @media (hover: none) {
    .cursor-dot,
    .cursor-follower {
      display: none;
    }
  }

  /* States */
  body.cursor-hover .cursor-dot {
    width: 10px;
    height: 10px;
    background: var(--color-green);
  }

  body.cursor-hover .cursor-follower {
    width: 56px;
    height: 56px;
    border-color: var(--color-green);
    opacity: 0.3;
  }
</style>

<script>
  function initCursor() {
    const dot = document.getElementById('cursor-dot');
    const follower = document.getElementById('cursor-follower');

    if (!dot || !follower) return;

    // Only on non-touch
    if (window.matchMedia('(hover: none)').matches) return;

    let mouseX = 0, mouseY = 0;
    let followerX = 0, followerY = 0;
    let rafId: number;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      dot.style.left = `${mouseX}px`;
      dot.style.top = `${mouseY}px`;
    });

    // Smooth follower
    function animateFollower() {
      followerX += (mouseX - followerX) * 0.12;
      followerY += (mouseY - followerY) * 0.12;
      follower.style.left = `${followerX}px`;
      follower.style.top = `${followerY}px`;
      rafId = requestAnimationFrame(animateFollower);
    }
    rafId = requestAnimationFrame(animateFollower);

    // Hover state on interactive elements
    const hoverTargets = 'a, button, [data-magnetic], input, textarea, select, label';

    document.addEventListener('mouseover', (e) => {
      if ((e.target as Element).closest(hoverTargets)) {
        document.body.classList.add('cursor-hover');
      }
    });

    document.addEventListener('mouseout', (e) => {
      if ((e.target as Element).closest(hoverTargets)) {
        document.body.classList.remove('cursor-hover');
      }
    });

    // Magnetic effect
    const magneticEls = document.querySelectorAll<HTMLElement>('[data-magnetic]');
    magneticEls.forEach((el) => {
      el.addEventListener('mousemove', (e) => {
        const rect = el.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const distX = (e.clientX - centerX) * 0.3;
        const distY = (e.clientY - centerY) * 0.3;
        el.style.transform = `translate(${distX}px, ${distY}px)`;
      });

      el.addEventListener('mouseleave', () => {
        el.style.transform = '';
        el.style.transition = `transform ${600}ms cubic-bezier(0.34, 1.56, 0.64, 1)`;
        setTimeout(() => { el.style.transition = ''; }, 600);
      });
    });

    return () => cancelAnimationFrame(rafId);
  }

  initCursor();
  document.addEventListener('astro:after-swap', initCursor);
</script>
